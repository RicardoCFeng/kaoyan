# 王道：计算机网络

### 第一章 计算机网络概述

##### 1.1 计算机网络概述

计算机网络的三种不同定义：

- 广义观点：只要是能实现远程信息处理的系统或能进一步达到资源共享的系统，都是计算机网络。定义了一个计算机通信网络，它在物理结构上具有计算机网络的雏形，但资源共享能力弱，是计算机网络发展的低级阶段。
- 资源共享观点：计算机网络是“以能够相互共享资源的方式互联起来的自治计算机系统的集合”。包含三层含义：1、目的：资源共享；2、组成单元：分布在不同地理位置的多台独立的“自治计算机”；3、网络中的计算机必须遵循的统一规则----网络协议。该定义符合目前计算机网络的基本特征。
- 用户透明性观点：存在一个能为用户自动管理资源的网络操作系统，它能够调用用户所需要的资源，而整个网络就像一个大的计算机系统一样对用户是透明的。定义描述了一个分布式系统，它是网络未来发展的目标。

计算机网络的组成

- 从组成部分上看，一个完整的计算机网络主要由硬件、软件、协议三大部分组成，缺一不可。硬件主要由主机（也称端系统）、通信链路（双绞线、光纤）、交换设备（如路由器、交换机等）和通信处理机（如网卡）等组成。软件主要包括各种实现资源共享的软件和方便用户使用的各种工具软件（如网络操作系统、邮件收发程序、FTP程序、聊天程序等）。软件部分多属于应用层。协议是计算机网络的核心；协议规定了网络传输数据时所遵循的规范。
- 从工作方式上看，计算机网络（这里主要指Internet）可分为边缘部分和核心部分。边缘部分由所有连接到因特网上、供用户直接使用的主机组成，用来进行通信（如传输数据、音频或视频）和资源共享；核心部分由大量的网络和连接这些网络的路由器组成，它为边缘部分提供连通性和交换服务。
- 从功能组成上看，计算机网络由通信子网和资源子网组成。通信子网由各种传输介质、通信设备和相应的网络协议组成，它使网络具有数据传输、交换、控制和存储的能力，实现联网计算机之间的数据通信。资源子网是实现资源共享功能的设备及其软件的集合，向网络用户提供共享其他计算机上的硬件资源，软件资源和数据资源的服务。

计算机网络的功能

- 数据通信：最基本和最重要的功能，用来实现联网计算之间的各种信息的传输，并将分散在不同地理位置的计算机联系起来，进行统一的调配、控制和管理。
- 资源共享：可以是软件共享、数据共享，也可以是硬件共享。使计算机网络中的资源互通有无、分工协作，从而极大地提高硬件资源、软件资源和数据库资源的利用率。
- 分布式处理：当计算机网络中的某个计算机系统负荷过重时，可以将其处理的某个复杂任务分配给网络中的其他计算机系统，从而利用空闲计算机资源以提高整个系统的利用率。
- 提高可靠性：计算机网络中的各台计算机可以通过网络互为替代机
- 负载均衡：将工作任务均衡地分配给计算机网络中的各台计算机

计算机网络的分类

- 按分布范围分类：
- - 广域网（WAN）：提供长距离通信，远程网，是因特网的核心部分；连接广域网的各节点交换机的链路一般都是高速链路，具有较大的通信容量。
  - 城域网（MAN）：大多采用以太网技术，常并入局域网的范围讨论。
  - 局域网（LAN）：用微机或工作站通过高速线路相连，覆盖范围较小；传统上，局域网采用广播技术，而广域网采用交换技术。
  - 个人区域网（PAN）：也称个人无线区域网（WPAN）
- 按传输技术分类
- - 广播式网络：所用联网计算机都共享一个公共通信信道；局域网基本上都采用广播式通信技术，广域网中的无线、卫星通信网络也采用广播式通信技术。
  - 点对点网络：每条物理线路连接一对计算机；如果通信的两台主机之间没有直接连接的线路，那么它们之间的分组传输就要通过中间结点的接收、存储和转发，直至目的结点。
- - 是否采用分组存储转发与路由选择机制是点对点网络与广播式网络的重要区别，广域网基本都属于点对点网络。
- 按拓扑机构分类
- - 网络拓扑结构是指由网中结点（路由器、主机等）与通信线路（网线）之间的集合关系表示的网络结构，主要指通信子网的拓扑结构。
  - 主要分为：星形、总线型、环形和网状形网络等。星形、总线型和环形网络多用于局域网，网状形网络多用于广域网。
  - 星形网络：每个终端或计算机都以单独的线路与中央设备相连
  - 总线形网络：用单根传输线把计算机连接起来
  - 环形网络：所有计算机接口设备连接成一个环
  - 网状形网络：一般情况下，每个结点至少有两条路径与其他结点相连，多用在广域网中。
- 按使用者分类
- - 公用网（Public Network）：公众网
  - 专用网（Private Network）
- 按交换技术分类
- - 交换技术是指各台主机之间、各通信设备之间或主机与通信设备之间为交换信息所采用的数据格式和交换装置的方式。
  - 电路交换网络：
  - 报文交换网络：
  - 分组交换网络：
- 按传输介质分类

计算机网络的标准化工作及相关组织

- 因特网的所有标准都以 RFC (Request For Comments) 的形式在因特网上发布，但并非每个RFC都是因特网的标准，RFC要上升为因特网的正式标需经过以下4个阶段：（1）因特网草案（Internet Draft），这个阶段还不是RFC文档；（2）建议标准（Proposed Standard），从这个阶段开始就成为RFC文档；（3）草案标准（Draft Standard）；（4）因特网标准（Internet Standard）
- 在国际上，负责制定、实施相关网络标准的标准化组织众多，主要有：国际标准化组织（ISO）；国际电信联盟（ITU）；国际电气电子工程师协会（IEEE）

计算机网络的性能指标

- 带宽（Bandwidth）：表示网络的通信线路所能传送数据的能力，是数字信道所能传送的“最高数据率”的同义语，单位是比特/秒（b/s）
- 时延（Delay）：指数据（一个报文或分组）从网络（或链路）的一端传送到另一端所需要的总时间，它由四部分组成：发送时延、传播时延、处理时延和排队时延
- - 发送时延：结点将分组的所有比特推向（传输）链路所需的时间，即从发送分组的第一个比特算起，到该分组的最后一个比特所发送完毕所需的时间，因此也称传输时延，计算公式为：发送时延 = 分组长度 / 信道宽度
  - 传播时延：电磁波在信道中传播一定的距离需要花费的时间，即一个比特从链路的一端传播到另一端所需的时间，计算公式为：传播时延 = 信道长度 / 电磁波在信道上的传播速率
  - 处理时延：数据在交换结点为存储转发而进行的一些必要的处理所花费的时间
  - 排队时延：分组在进入路由器后要先在输入队列中排队等待处理
- - 总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延（排队时延和处理时延一般可以忽略不计；对于高速链路，提高的仅是数据发送速率而非比特在链路上的传播速率，提高数据的发送速率只是为了减少数据的发送时延）
- 时延带宽积：指发送端连续发送数据且发送的第一个比特即将到达终点时，发送端已经发出的比特数，即时延带宽积 = 传播时延 * 信道带宽 
- 往返时延 (Round-Trip Time, RTT)：指从发送端发送数据开始，到发送端收到来自接收端的确认（接收端收到数据后立即发送确认），总共经历的时延。互联网中，往返时延还包括各中间结点的处理时延、排队时延及转发数据时的发送时延
- 吞吐量（Throughput）：指单位时间内通过某个网络（或信道、接口）的数据量，受网络带宽或网络额定速率的限制
- 速率（Speed）：网络中的速率是指连接到计算机网络上的主机在数字信道上传送数据的速率，也称数据率或比特率，通常把最高数据率称为带宽

##### 1.2 计算机网络体系结构与参考模型

计算机网络的分层机构

- 把计算机网络的各层及其协议的集合称为网络的体系结构（Architecture），即计算机网络的体系结构就是这个计算机网络及其所应完成的功能的精确定义，它是计算机网络中的层次、各层的协议及层间接口的集合
- 分层原则：1）每层都实现一种相对独立的功能，降低大系统的复杂度；2）各层之间界面自然清晰，易于理解，相互交流尽可能少；3）各层功能的精确定义独立于具体的实现方法，可以采用最合适的技术来实现；4）保持下层对上层的独立性，上层单向使用下层提供的服务；5）整个分层机构应能促进标准化工作
- 在计算机网络的分层结构中，第n层中的活动元素通常称为n层实体。实体指任何可发送或接收消息的硬件或软件进程，通常是一个特定的软件模块。不同机器上的同一层称为对等层，同一层的实体称为对等实体。n层实体实现的服务为n+1层所利用，在这种情况下，n层被称为服务提供者，n+1层则服务于用户
- 在计算机网络体系结构的各个层次中，每个报文都分为两部分：一是数据部分，即SDU；二是控制信息部分，即PCI；它们共同组成PDU
- - 服务数据单元(SDU)：为完成用户所要求的功能而应传送的数据。第n层的服务数据单元记为n-SDU
  - 协议控制单元(PCI)：控制协议操作的信息。第n层的协议控制信息记为n-PCI
  - 协议数据单元(PDU)：对等层次之间传送的数据单元称为该层的PDU。第n层的协议数据单元记为n-PDU
- n-SDU + n-PCI = n-PDU = (n-1)-SDU
- 第n层的实体不仅要使用第n-1层的服务来实现自身定义的功能，还要向第n+1层提供本层的服务，该服务是第n层及其下面各层提供的服务综合
- 最底层只提供服务，是整个层次结构的基础；中间各层既是下一层的服务使用者，又是上一层的服务提供者；最高层面向用户提供服务
- 上一层智能通过相邻层间的接口使用下一层的服务，而不能调用其他层次的服务；下一层所提供服务的实现细节对上一层透明
- 两台主机通信时，对等层在逻辑上有一条直接信道，表现为不经过下层就把信息传送到对方

计算机网络协议、接口、服务的概念

- 协议：将为进行网络中的数据交换而建立的规则、标准或约定称为网络协议 (Network Protocol)，它是控制两个（或多个）对等实体进行通信的规则的集合，是水平的。不对等实体之间是没有协议的。协议由语法、语义和同步三部分组成。语法规定了传输数据的格式；语义规定了所要完成的功能，即需要发出何种控制信息、完成何种动作及做出何种应答；同步规定了执行各种操作的条件、时序关系等，即事件实现顺序的详细说明。一个完整的协议通常应具有线路管理（建立、释放连接）、差错控制、数据转换等功能
- 接口：同一结点内相邻两层之间交换信息的连接点，是一个系统内部的规定。每层只能为紧邻的层次之间定义接口，不能跨层定义接口；在典型的接口上，同一结点相邻两层的实体通过服务访问点 (Service Access Point, SAP) 进行交互；服务是通过SAP提供给上层使用的，第n层的SAP就是第n+1层可以访问第n层服务的地方；每个SAP都有一个能够标识它的地址，SAP实际是一个逻辑接口
- 服务：下层为紧邻的上层提供的功能调用，它是垂直的。对等实体在协议的控制下，使得本层能为上一层提供服务，但要实现本层协议还需要使用下一层所提供得服务；上层使用下层所提供的服务时必须于下层交换一些命令，这些命令在OSI中称为服务原语，分为四类：
- - 请求 (Request)：由服务用户发往服务提供者，请求完成某项工作
  - 指示 (Indication)：由服务提供者发往服务用户，指示用户做某件事情
  - 响应 (Response)：由服务用户发往服务提供者，作为对指示的响应
  - 证实 (Confirmation)：由服务提供者发往服务用户，作为对请求的证实
- 只有本层协议的实现才能保证向上一层提供服务，本层的服务用户只能看见服务而无法看见下面的协议，即下面的协议对上层的服务用户是透明的；协议是“水平的”，即协议是控制对等实体之间通信的规则，服务是“垂直的”，即服务是由下层通过层间接口向上层提供的。只有能被高一层实体看见的功能才称为服务
- 计算机网络提供的服务可按以下三种方式分类：
- - 面向连接服务与无连接服务：面向连接服务可以分为连接建立、数据传输和连接释放三个阶段(TCP)；无连接服务是一种不可靠服务，尽最大努力支付(Best-Effort-Delivery)，不保证通信的可靠性(IP, UDP)
  - 可靠服务和不可靠服务：可靠服务能保证数据正确、可靠地传送到目的地；不可靠不能保证数据正确，是一种尽力而为地服务，不可靠服务对于网络地准确性需要考应用或用户来保证
  - 有应答服务和无应答服务：有应答服务指在接收方在收到数据后向发送方给出相应地应答，由系统内部实现；无应答服务指接收方收到数据后不自动给出应答

ISO/OSI参考模型和TCP/IP模型

- 国际标准化组织 (ISO) 提出的网络体系结构模型，称为开放系统互连参考模型 (OSI/RM)，简称OSI参考模型；OSI有七层，自下而上为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层；低三层统称为通信子网，是为了联网而附加的通信设备，完成数据的传输功能；高三层统称为资源子网，相当于计算机系统，完成数据的处理等功能；传输层承上启下。
- 物理层 (Physical Layer)：传输单位是比特，任务是透明的传输比特流，功能是在物理媒体上为数据端设备透明地传输原始比特流；物理层主要定义数据终端设备 (DTE) 和数据通信设备 (DCE) 的物理与逻辑连接方法，所以物理层协议也称物理层接口标准，又称物理层规程 (Procedure)，物理层接口标准：EIA-232C, EIA/TIA RS-449, CCITT的X.21等
- 数据链路层 (Data Link Layer)：传输单位是帧，任务是将网络层传来的IP数据报组装成帧，功能可以概括为成帧、差错控制、流量控制和传输管理等。特殊的子层----介质访问子层，处理如何控制对共享信道的访问；数据链路层协议：SDLC, HDLC, PPP, STP 和帧中继等
- 网络层 (Network Layer)：传输单位是数据报，关心的是通信子网的运行控制，主要任务是把网络层的协议数据单元（分组）从源端传到目的端，为分组交换网上的不同主机提供通信服务；关键问题是对分组进行路由选择，并实现流量控制、拥塞控制、差错控制和网际互连等功能